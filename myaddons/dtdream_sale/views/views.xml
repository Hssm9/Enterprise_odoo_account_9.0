<openerp>
  <data>
      <!--产品视图-->
      <record id="view_res_product_template_form_inherit" model="ir.ui.view">
          <field name="name">view.res.product.template.form.inherit</field>
          <field name="model">product.template</field>
          <field name="inherit_id" ref="product.product_template_form_view" />
          <field name="arch" type="xml">
              <field name="list_price" position="attributes">
                  <attribute name="invisible">1</attribute>
              </field>
              <group name="group_lots_and_weight" position="attributes">
                  <attribute name="invisible">1</attribute>
              </group>
              <label for="standard_price" position="attributes">
                  <attribute name="invisible">1</attribute>
              </label>
              <div name="standard_price_uom" position="attributes">
                  <attribute name="invisible">1</attribute>
              </div>
              <field name="categ_id" position="attributes">
                  <attribute name="invisible">1</attribute>
              </field>
              <field name="name" position="attributes">
                  <attribute name="string">产品型号</attribute>
              </field>
              <field name="type" position="before">
                  <field name="bom" />
                  <field name="pro_version" />
                  <field name="pro_status" string="状态"/>
              </field>
              <field name="uom_po_id" position="after">
                  <field name="categ_id"/>
                  <field name="list_price" string="目录价"/>
                  <field name="ref_discount" />
                  <field name="pro_description" />
              </field>
              <field name="list_price" position="before">
                  <field name="pro_type" />
              </field>
              <field name="invoice_policy" position="after">
                  <field name="remark" />
              </field>
              <xpath expr="//page[@name='sales']" position="after">
                  <page name="discount" string="授权折扣" groups="dtdream_sale.group_product_query,dtdream_sale.group_product_manage">
                      <group>
                          <group>
                              <field name="office_manager_discount" />
                              <field name="market_president_discount" />
                          </group>
                          <group>
                              <field name="system_department_discount" />
                          </group>
                      </group>
                  </page>
              </xpath>
          </field>
      </record>

      <record id="view_res_product_template_tree_view" model="ir.ui.view">
          <field name="name">view.res.product.template.tree</field>
          <field name="model">product.template</field>
          <field name="priority">13</field>
          <field name="arch" type="xml">
              <tree string="Product">
                  <field name="categ_id"/>
                  <field name="pro_type"/>
                  <field name="bom"/>
                  <field name="name" string="产品名称"/>
                  <field name="uom_id"/>
                  <field name="pro_description"/>
                  <field name="seller_ids"/>
                  <field name="pro_status" string="状态"/>
                  <field name="pro_version"/>
                  <field name="write_date"/>
              </tree>
          </field>
      </record>
      <!--重写机会点tree视图-->
      <record id="view_res_product_leads_tree_view" model="ir.ui.view">
            <field name="name">view.res.product.leads.tree</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_tree_view_leads"/>
            <field name="arch" type="xml">
                <field name="name" position="before">
                    <field name="project_number"/>
                </field>
                <field name="name" position="after">
                    <field name="project_leave" string="项目级别"/>
                    <field name="office_id"/>
                    <field name="industry_id"/>
                    <field name="bidding_time"/>
                    <field name="supply_time"/>
                    <field name="user_id" string="营销责任人" on_change="on_change_user(user_id, context)" context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'base.group_sale_salesman_all_leads'], 'team_id': team_id}"/>
                </field>
                <field name="create_date" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="contact_name" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="country_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="email_from" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="phone" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="stage_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="team_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
            </field>
        </record>

      <!--项目管理字段添加-->
      <record id="view_res_product_oppr_form" model="ir.ui.view">
            <field name="name">view.res.product.oppr</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
            <field name="arch" type="xml">
                <field name="partner_id" position="before">
                    <field name="project_number"/>
                    <field name="project_leave" string="项目级别"/>
                    <field name="office_id"/>
                    <field name="system_department_id" domain="[('parent_id','=',False)]"/>
                    <field name="industry_id" domain="[('parent_id.parent_id','=',False)]"/>
                    <field name="bidding_time"/>
                    <field name="supply_time"/>
                    <field name="pre_implementation_time"/>
                    <field name="pre_check_time"/>
                    <field name="project_detail"/>
                    <field name="sale_channel"/>
                </field>
                <field name="partner_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="email_from" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="phone" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <div class="o_address_format" position="attributes">
                    <attribute name="invisible">1</attribute>
                </div>
                <div class="o_address_format" position="replace">
                </div>
                <field name="partner_name" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="partner_name" position="replace">
                </field>
                <label for="street" position="attributes">
                    <attribute name="invisible">1</attribute>
                </label>
                <label for="street" position="replace">
                </label>
                <field name="date_deadline" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="team_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="team_id" position="replace">
                </field>
                <field name="user_id" position="after">
                    <field name="team_id" domain="[('use_leads','=',True)]"/>
                </field>
                <h2 position="attributes">
                    <attribute name="invisible">1</attribute>
                </h2>
                <field name="email_from" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="function" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="phone" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <div class="o_row" position="attributes">
                    <attribute name="invisible">1</attribute>
                </div>
                <field name="probability" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="fax" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <label for="contact_name" position="attributes">
                    <attribute name="invisible">1</attribute>
                </label>
                <field name="contact_name" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="contact_name" position="replace">
                </field>
                <field name="title" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <div class="o_row" position="attributes">
                    <attribute name="invisible">1</attribute>
                </div>
                <field name="mobile" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="mobile" position="replace">
                </field>
                <field name="date_deadline" position="after">
                    <field name="project_master_degree"/>
                    <field name="project_space"/>
                    <field name="ali_division"/>
                    <field name="ali_saleman"/>
                    <field name="partner_id" string="客户"
                           on_change="on_change_partner_id(partner_id)"
                           context="{'default_name': contact_name, 'default_street': street, 'default_city': city, 'default_state_id': state_id, 'default_zip': zip, 'default_country_id': country_id, 'default_function': function, 'default_phone': phone, 'default_mobile': mobile, 'default_fax': fax, 'default_email': email_from, 'default_user_id': user_id, 'default_team_id': team_id}"/>
                    <field name="partner_name" string="公司名称"/>
                    <label for="street" string="地址"/>
                    <div class="o_address_format">
                        <field name="street" placeholder="街道..." class="o_address_street"/>
                        <field name="city" placeholder="城市" class="o_address_city"/>
                        <field name="state_id" class="o_address_state" placeholder="省份" options='{"no_open": True}' on_change="onchange_state(state_id)"/>
                        <field name="zip" placeholder="邮编" class="o_address_zip"/>
                        <field name="country_id" placeholder="国家" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
                    </div>
                    <label for="contact_name"/>
                    <div class="o_row">
                        <field name="contact_name"/>
                        <field name="title" placeholder="Title" domain="[]" options='{"no_open": True}'/>
                    </div>
                    <field name="email_from" widget="email"/>
                    <field name="function"/>
                    <field name="phone" widget="phone"/>
                    <field name="mobile"/>
                </field>
                <div class="o_row mr16" position="attributes">
                    <attribute name="invisible">1</attribute>
                </div>
                <label for="next_activity_id" position="replace">
                    <attribute name="invisible"></attribute>
                </label>
                <xpath expr="//page[@name='lead']" position="after">
                    <page string="产品配置">
                            <field name="product_line" mode="tree">
                                <tree string="产品配置" editable="bottom" >
                                    <field name="product_id" string="产品" widget="selection"/>
                                    <field name="bom" string="BOM" />
                                    <field name="pro_type" string="产品类别"/>
                                    <field name="pro_description" string="产品描述"/>
                                    <field name="pro_name" string="产品名称"/>
                                    <field name="list_price" string="目录价"/>
                                    <field name="ref_discount" string="参考折扣"/>
                                    <field name="apply_discount" string="申请折扣"/>
                                    <field name="pro_num" string="数量"/>
                                    <field name="config_set" string="配置组"/>
                                </tree>
                            </field>
                            <group class="oe_subtotal_footer oe_right" name="product_total">
                                <field name="total_list_price"  class="oe_subtotal_footer_separator"/>
                                <field name="total_ref_price" class="oe_subtotal_footer_separator"/>
                                <field name="total_apply_price" class="oe_subtotal_footer_separator"/>
                            </group>
                    </page>
                </xpath>
                <xpath expr="//page[@name='lead']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
            </field>
      </record>

      <!--重写项目管理tree视图-->
      <record id="view_res_product_oppr_tree" model="ir.ui.view">
            <field name="name">view.res.product.oppr.tree</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_tree_view_oppor"/>
            <field name="arch" type="xml">
                <field name="name" position="before">
                    <field name="project_number"/>
                </field>
                <field name="name" position="after">
                    <field name="project_leave" string="项目级别"/>
                    <field name="office_id"/>
                    <field name="industry_id"/>
                    <field name="bidding_time"/>
                    <field name="supply_time"/>
                </field>
                <field name="create_date" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="partner_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="country_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="date_action" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="title_action" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="stage_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="planned_revenue" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="probability" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="team_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
            </field>
        </record>

      <!--产品类别-->
      <record id="product_pro_type_form_view" model="ir.ui.view">
          <field name="name">product.pro.type.form</field>
          <field name="model">product.pro.type</field>
          <field name="arch" type="xml">
              <form string="产品类别">
                  <sheet>
                      <group>
                          <field name="name"/>
                      </group>
                      <group>

                      </group>
                  </sheet>
              </form>
          </field>
      </record>

      <!--项目查阅权限视图-->
      <record id="view_res_users_access_form_inherit" model="ir.ui.view">
          <field name="name">view.res.users.access.form.inherit2</field>
          <field name="model">res.users</field>
          <field name="inherit_id" ref="base.view_users_form" />
          <field name="arch" type="xml">
              <xpath expr="//page[@name='access_rights']" position="after">
                  <page name="access_office" string="办事处">
                      <field name="user_access_office" widget="many2many_kanban">
                          <kanban quick_create="false" create="true" delete="true">
                              <field name="name"/>
                              <templates>
                                  <t t-name="kanban-box">
                                      <div class="oe_kanban_global_click" style="position: relative">
                                          <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 0; padding: 4px; diplay: inline-block">X</a>
                                          <div class="oe_module_vignette">
                                              <img t-att-src="kanban_image('res.users', 'image_small', record.id.value)" class="oe_avatar oe_kanban_avatar_smallbox"/>
                                              <div class="oe_module_desc">
                                                  <field name="name"/>
                                              </div>
                                          </div>
                                      </div>
                                  </t>
                              </templates>
                          </kanban>
                      </field>
                  </page>
                  <page name="access_industry" string="行业">
                      <field name="user_access_industry" widget="many2many_kanban">
                          <kanban quick_create="false" create="true" delete="true">
                              <field name="name"/>
                              <templates>
                                  <t t-name="kanban-box">
                                      <div class="oe_kanban_global_click" style="position: relative">
                                          <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 0; padding: 4px; diplay: inline-block">X</a>
                                          <div class="oe_module_vignette">
                                              <img t-att-src="kanban_image('res.users', 'image_small', record.id.value)" class="oe_avatar oe_kanban_avatar_smallbox"/>
                                              <div class="oe_module_desc">
                                                  <field name="name"/>
                                              </div>
                                          </div>
                                      </div>
                                  </t>
                              </templates>
                          </kanban>
                      </field>
                  </page>
              </xpath>
          </field>
      </record>

      <!--定义产品类别action-->
      <record id="product_pro_type_form_action" model="ir.actions.act_window">
          <field name="name">产品类别</field>
          <field name="type">ir.actions.act_window</field>
          <field name="res_model">product.pro.type</field>
          <field name="view_type">form</field>
          <field name="view_mode">tree,form</field>
      </record>

      <!-- 定义机会点 -->
      <record model="ir.ui.view" id="dtdream_sale.crm_lead_form">
          <field name="name">机会点</field>
          <field name="model">crm.lead</field>
          <field name="inherit_id" ref="crm.crm_case_form_view_leads"/>
          <field name="arch" type="xml">
              <field name="partner_id" position="before">
                  <field name="project_number"/>
                  <field name="project_leave" string="项目级别"/>
                  <field name="office_id"/>
                  <field name="system_department_id" domain="[('parent_id','=',False)]"/>
                  <field name="industry_id" domain="[('parent_id.parent_id','=',False)]"/>
                  <field name="bidding_time"/>
                  <field name="supply_time"/>
                  <field name="pre_implementation_time"/>
                  <field name="pre_check_time"/>
                  <field name="project_detail"/>
                  <field name="sale_channel"/>
              </field>
              <div class="o_address_format" position="attributes">
                  <attribute name="invisible">1</attribute>
              </div>
              <field name="partner_id" position="attributes">
                  <attribute name="invisible">1</attribute>
              </field>
              <field name="partner_name" position="attributes">
                  <attribute name="invisible">1</attribute>
              </field>
              <label for="street" position="attributes">
                  <attribute name="invisible">1</attribute>
              </label>
              <label for="contact_name" position="before">
                  <!--<field name = "child_ids"></field>-->
                  <field name="project_master_degree"/>
                  <field name="project_space"/>
                  <field name="ali_division"/>
                  <field name="ali_saleman"/>
                  <field name="partner_id" string="客户"
                         on_change="on_change_partner_id(partner_id)"
                         options='{"create_name_field": "name"}'
                         context="{'default_name': contact_name, 'default_street': street, 'default_city': city, 'default_state_id': state_id, 'default_zip': zip, 'default_country_id': country_id, 'default_function': function, 'default_phone': phone, 'default_mobile': mobile, 'default_fax': fax, 'default_email': email_from, 'default_user_id': user_id, 'default_team_id': team_id}"/>
                  <field name="partner_name" string="公司名称"/>
                  <label for="street" string="地址"/>
                  <div class="o_address_format">
                      <field name="street" placeholder="街道..." class="o_address_street"/>
                      <field name="city" placeholder="城市" class="o_address_city"/>
                      <field name="state_id" class="o_address_state" placeholder="省份" options='{"no_open": True}' on_change="onchange_state(state_id)"/>
                      <field name="zip" placeholder="邮编" class="o_address_zip"/>
                      <field name="country_id" placeholder="国家" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
                  </div>
              </label>
              <field name="fax" position="attributes">
                  <attribute name="invisible">1</attribute>
              </field>
              <field name="user_id" position="replace">
                  <field name="user_id" on_change="on_change_user(user_id, context)"
                                context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'base.group_sale_salesman_all_leads'], 'team_id': team_id}"
                                domain="[('login','!=','admin')]"/>
              </field>
              <field name="team_id" position="replace">
              </field>
              <field name="user_id" position="after">
                  <field name="team_id" domain="[('use_leads','=',True)]"/>
              </field>
              <xpath expr="//page[@name='extra']" position="attributes">
                  <attribute name="invisible">1</attribute>
              </xpath>
          </field>
      </record>

      <!--产品搜索界面增加产品分类分组-->
      <record id="product_search_form_inherit_view" model="ir.ui.view">
          <field name="name">product.template.search.inherit</field>
          <field name="model">product.template</field>
          <field name="inherit_id" ref="product.product_template_search_view"/>
          <field name="arch" type="xml">
               <field name="pricelist_id" position="after">
                  <filter string="产品分类" name="categ_id" context="{'group_by':'categ_id'}"/>
               </field>
          </field>
      </record>

      <!--销售团队字段修改-->
      <record model="ir.ui.view" id="dtdream_sale.crm_team_view_form">
            <field name="name">crm.team.form</field>
            <field name="model">crm.team</field>
            <field name="inherit_id" ref="sales_team.crm_team_view_form"/>
            <field name="arch" type="xml">
                <field name="member_ids" position="replace">
                    <field name="res_member_ids" widget="many2many_kanban" options="{'not_delete': True}">
                        <kanban quick_create="false" create="true" delete="true">
                            <field name="name"/>
                            <templates>
                                <t t-name="kanban-box">
                                    <div class="oe_kanban_global_click" style="position: relative">
                                        <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 0; padding: 4px; diplay: inline-block">X</a>
                                        <div class="oe_module_vignette">
                                            <img t-att-src="kanban_image('res.users', 'image_small', record.id.value)" class="oe_avatar oe_kanban_avatar_smallbox"/>
                                            <div class="oe_module_desc">
                                                <field name="name"/>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                </field>
            </field>
      </record>


      <!--新增产品类别菜单-->
      <menuitem name="产品类别" action="product_pro_type_form_action" id="menu_product_pro_type_form_action" parent="product.prod_config_main" sequence="8" />

      <menuitem id="crm.crm_lead_menu_activities" name="Next Activities" sequence="5"
        parent="base.menu_sales" action="crm.crm_lead_action_activities" groups="base.group_no_one"/>
      <!--<menuitem id="base.menu_invoiced" name="Invoicing" parent="base.menu_aftersale" sequence="1" groups="base.group_no_one"/>-->
      //开票
      <menuitem name="Invoicing"
            id="sale.menu_sale_invoicing" parent="base.menu_base_partner"
            sequence="5" groups="base.group_no_one"/>
      <menuitem action="sale.action_orders_to_invoice"
            id="sale.menu_sale_order_invoice" parent="sale.menu_sale_invoicing"
            sequence="2" groups="base.group_no_one"/>
      <menuitem action="sale.action_orders_upselling"
            id="sale.menu_sale_order_upselling" parent="sale.menu_sale_invoicing"
            sequence="5" groups="base.group_no_one"/>
      //报价
      <menuitem id="sale.menu_sale_quotations"
            action="sale.action_quotations" parent="base.menu_sales"
            sequence="11" groups="base.group_no_one"/>
      //销售订单
      <record id="sale.menu_sale_order" model="ir.ui.menu">
          <field name="groups_id" eval="[(6, 0, [ref('base.group_no_one')])]"/>
      </record>
      //销售顶级菜单
      <menuitem name="Sales"
            id="base.menu_base_partner"
            web_icon="sale,static/description/icon.png"
            groups="base.group_sale_salesman,base.group_sale_manager,group_dtdream_sale_read" sequence="6"/>
      //仪表盘
      <menuitem id="sales_team.menu_sales_team_act" action="sales_team.crm_team_salesteams_act" sequence="1" parent="base.menu_base_partner" name="Dashboard" groups="base.group_no_one"/>
  </data>
</openerp>